pipeline {
    agent any
    tools {
        // Reference the Maven installation configured in Global Tool Configuration
        maven 'Maven'  // 'Maven' is the name you provided in the Global Tool Configuration
    }
    environment {
        OPENSHIFT_PROJECT = "sindhupsvn13-dev"
        OPENSHIFT_URL = "https://api.sandbox-m2.ll9k.p1.openshiftapps.com:6443"
        OPENSHIFT_TOKEN = credentials('OPENSHIFT_TOKEN')
        DOCKER_IMAGE_NAME = "missing-number-app"
        DOCKER_REGISTRY = "docker.io/sindhu138"
    }
    stages {
        stage('Checkout') {
            steps {
                git url: 'https://github.com/Satyaksvn/MissingNumber', branch: 'main'
            }
        }
        stage('Build') {
            steps {
                echo 'Building Java Application'
                sh 'mvn clean install'  // This will use the Maven tool installed in Jenkins
            }
        }
        stage('Docker Build & Push') {
            steps {
                echo 'Building Docker Image'
                sh 'docker build -t $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME .'
                sh 'docker login --username $DOCKER_REGISTRY --password $DOCKER_PASSWORD'
                sh 'docker push $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME'
            }
        }
        stage('Deploy to OpenShift') {
            steps {
                echo 'Deploying to OpenShift'
                sh 'oc login $OPENSHIFT_URL --token=$OPENSHIFT_TOKEN'
                sh 'oc project $OPENSHIFT_PROJECT'
                sh 'oc new-app $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME'
            }
        }
    }
    post {
        success {
            echo 'Pipeline successfully completed.'
        }
        failure {
            echo 'Pipeline failed. Please check the logs for details.'
        }
    }
}
